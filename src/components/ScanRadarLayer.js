// eslint-disable-next-line no-undef
// import {radarDataColor,radarDataRange} from '../constant'
export const radarDataColor = ["#003DDF", "#003FDF", "#0041DE", "#0043DE", "#0044DD", "#0046DD", "#0048DC", "#004ADC", "#004BDB", "#004DDB", "#004FDA", "#0051DA", "#0052D9", "#0054D9",
  "#0056D8", "#0058D8", "#0059D7", "#005BD7", "#005DD6", "#005FD6", "#0060D5", "#0062D5", "#0064D4", "#0066D4", "#0067D3", "#0069D3", "#006BD2", "#006DD2",
  "#006ED1", "#0070D1", "#0072D0", "#0074D0", "#0075CF", "#0077CF", "#0079CE", "#007BCE", "#007CCD", "#007ECD", "#0080CC", "#0082CC", "#0083CB", "#0085CB",
  "#0087CA", "#0089CA", "#008AC9", "#008CC9", "#008EC8", "#0090C8", "#0091C7", "#0093C7", "#0095C6", "#0097C6", "#0098C5", "#009AC5", "#009CC4", "#009EC4",
  "#009FC3", "#00A1C3", "#00A3C2", "#00A5C2", "#00A6C1", "#00A8C1", "#00AAC0", "#00ACC0", "#01B0BD", "#03B1BA", "#04B2B7", "#06B4B4", "#07B5B1", "#09B6AE",
  "#0AB7AB", "#0CB9A8", "#0DBAA5", "#0FBBA2", "#10BC9F", "#12BE9C", "#13BF99", "#15C096", "#16C193", "#18C390", "#19C48D", "#1BC58A", "#1CC687", "#1EC884",
  "#1FC981", "#21CA7E", "#22CB7B", "#24CD78", "#25CE75", "#27CF72", "#28D06F", "#2AD26C", "#2BD369", "#2DD466", "#2ED563", "#30D760", "#31D85D", "#33D95A",
  "#34DA57", "#36DC54", "#37DD51", "#39DE4E", "#3ADF4B", "#3CE148", "#3DE245", "#3FE342", "#40E43F", "#42E63C", "#43E739", "#45E836", "#46E933", "#48EB30",
  "#49EC2D", "#4BED2A", "#4CEE27", "#4EF024", "#4FF121", "#51F21E", "#52F31B", "#54F518", "#55F615", "#57F712", "#58F80F", "#5AFA0C", "#5BFB09", "#5DFC06",
  "#5EFD03", "#60FF00", "#61FF00", "#64FF00", "#66FF00", "#69FF00", "#6BFF00", "#6EFF00", "#70FF00", "#73FF00", "#75FF00", "#78FF00", "#7AFF00", "#7DFF00",
  "#7FFF00", "#82FF00", "#84FF00", "#87FF00", "#89FF00", "#8CFF00", "#8EFF00", "#91FF00", "#93FF00", "#96FF00", "#98FF00", "#9BFF00", "#9DFF00", "#A0FF00",
  "#A2FF00", "#A5FF00", "#A7FF00", "#AAFF00", "#ACFF00", "#AFFF00", "#B1FF00", "#B4FF00", "#B6FF00", "#B9FF00", "#BBFF00", "#BEFF00", "#C0FF00", "#C3FF00",
  "#C5FF00", "#C8FF00", "#CAFF00", "#CDFF00", "#CFFF00", "#D2FF00", "#D4FF00", "#D7FF00", "#D9FF00", "#DCFF00", "#DEFF00", "#E1FF00", "#E3FF00", "#E6FF00",
  "#E8FF00", "#EBFF00", "#EDFF00", "#F0FF00", "#F2FF00", "#F5FF00", "#F7FF00", "#FAFF00", "#FCFF00", "#FFFF00", "#FFFE00", "#FFFC00", "#FFFA00", "#FFF800",
  "#FFF600", "#FFF400", "#FFF200", "#FFF000", "#FFEE00", "#FFEC00", "#FFEA00", "#FFE800", "#FFE600", "#FFE400", "#FFE200", "#FFE000", "#FFDE00", "#FFDC00",
  "#FFDA00", "#FFD800", "#FFD600", "#FFD400", "#FFD200", "#FFD000", "#FFCE00", "#FFCC00", "#FFCA00", "#FFC800", "#FFC600", "#FFC400", "#FFC200", "#FFC000",
  "#FFBE00", "#FFBC00", "#FFBA00", "#FFB800", "#FFB600", "#FFB400", "#FFB200", "#FFB000", "#FFAE00", "#FFAC00", "#FFAA00", "#FFA800", "#FFA600", "#FFA400",
  "#FFA200", "#FFA000", "#FF9E00", "#FF9C00", "#FF9A00", "#FF9800", "#FF9600", "#FF9400", "#FF9200", "#FF9000", "#FF8E00", "#FF8C00", "#FF8A00", "#FF8800",
  "#FF8600", "#FF8400", "#FF8200", "#FF8000", "#FF7E00", "#FF7C00", "#FF7A00", "#FF7800", "#FF7600", "#FF7400", "#FF7200", "#FF7000", "#FF6E00", "#FF6C00",
  "#FF6A00", "#FF6800", "#FF6600", "#FF6400", "#FF6200", "#FF6000", "#FF5E00", "#FF5C00", "#FF5A00", "#FF5800", "#FF5600", "#FF5400", "#FF5200", "#FF5000",
  "#FF4E00", "#FF4C00", "#FF4A00", "#FF4800", "#FF4600", "#FF4400", "#FF4200", "#FF4000", "#FF3E00", "#FF3C00", "#FF3A00", "#FF3800", "#FF3600", "#FF3400",
  "#FF3200", "#FF3000", "#FF2E00", "#FF2C00", "#FF2A00", "#FF2800", "#FF2600", "#FF2400", "#FF2200", "#FF2000", "#FF1E00", "#FF1C00", "#FF1A00", "#FF1800",
  "#FF1600", "#FF1400", "#FF1200", "#FF1000", "#FF0E00", "#FF0C00", "#FF0A00", "#FF0800", "#FF0600", "#FF0400", "#FF0200", "#FF0000"
];


export const radarDataRange = [0, 0.003, 0.006, 0.009, 0.013, 0.016, 0.019, 0.022, 0.025, 0.028, 0.031, 0.034, 0.038, 0.041, 0.044, 0.047, 0.05, 0.053, 0.056, 0.06, 0.063, 0.066, 0.069, 0.072, 0.075, 0.078, 0.082, 0.085, 0.088, 0.091, 0.094, 0.097, 0.1, 0.103, 0.107, 0.11, 0.113, 0.116, 0.119, 0.122, 0.125, 0.129, 0.132, 0.135, 0.138, 0.141, 0.144, 0.147, 0.15, 0.154, 0.157, 0.16,
    0.163, 0.166, 0.169, 0.172, 0.176, 0.179, 0.182, 0.185, 0.188, 0.191, 0.194, 0.197, 0.201, 0.204, 0.207, 0.21, 0.213, 0.216,
    0.219, 0.223, 0.226, 0.229, 0.232, 0.235, 0.238, 0.241, 0.245, 0.248, 0.251, 0.254, 0.257, 0.26, 0.263, 0.266,
    0.27, 0.273, 0.276, 0.279, 0.282, 0.285, 0.288, 0.292, 0.295, 0.298, 0.301, 0.304, 0.307, 0.31, 0.313, 0.317, 0.32,
    0.323, 0.326, 0.329, 0.332, 0.335, 0.339, 0.342, 0.345, 0.348, 0.351, 0.354, 0.357, 0.361, 0.364, 0.367, 0.37, 0.373,
    0.376, 0.379, 0.382, 0.386, 0.389, 0.392, 0.395, 0.398, 0.401, 0.404, 0.408, 0.411, 0.414, 0.417, 0.42, 0.423, 0.426, 0.429,
    0.433, 0.436, 0.439, 0.442, 0.445, 0.448, 0.451, 0.455, 0.458, 0.461, 0.464, 0.467, 0.47, 0.473, 0.476, 0.48, 0.483, 0.486, 0.489,
    0.492, 0.495, 0.498, 0.502, 0.505, 0.508, 0.511, 0.514, 0.517, 0.52, 0.524, 0.527, 0.53, 0.533, 0.536, 0.539, 0.542, 0.545, 0.549,
    0.552, 0.555, 0.558, 0.561, 0.564, 0.567, 0.571, 0.574, 0.577, 0.58, 0.583, 0.586, 0.589, 0.592, 0.596, 0.599, 0.602, 0.605, 0.608,
    0.611, 0.614, 0.618, 0.621, 0.624, 0.627, 0.63, 0.633, 0.636, 0.639, 0.643, 0.646, 0.649, 0.652, 0.655, 0.658, 0.661, 0.665, 0.668, 0.671,
    0.674, 0.677, 0.68, 0.683, 0.687, 0.69, 0.693, 0.696, 0.699, 0.702, 0.705, 0.708, 0.712, 0.715, 0.718, 0.721, 0.724, 0.727, 0.73, 0.734, 0.737,
    0.74, 0.743, 0.746, 0.749, 0.752, 0.755, 0.759, 0.762, 0.765, 0.768, 0.771, 0.774, 0.777, 0.781, 0.784, 0.787, 0.79, 0.793, 0.796, 0.799, 0.803,
    0.806, 0.809, 0.812, 0.815, 0.818, 0.821, 0.824, 0.828, 0.831, 0.834, 0.837, 0.84, 0.843, 0.846, 0.85, 0.853, 0.856, 0.859, 0.862, 0.865, 0.868, 0.871,
    0.875, 0.878, 0.881, 0.884, 0.887, 0.89, 0.893, 0.897, 0.9, 0.903, 0.906, 0.909, 0.912, 0.915, 0.918, 0.922, 0.925, 0.928, 0.931, 0.934, 0.937, 0.94,
    0.944, 0.947, 0.95, 0.953, 0.956, 0.959, 0.962, 0.966, 0.969, 0.972, 0.975, 0.978, 0.981, 0.984, 0.987, 0.991, 0.994, 0.997, 1
]
export class ScanRadarLayer {
    _defaultRadius = 1000; // 默认半径;
    _defaultOpacity = 95; // 缺省透明度;
    _canvasFm
    _scanRadarCanvas
    _ctx
    _p = 667; // 单次扫描分辨率(暂定);
    _R // 设定的半径;
    _offsetR; // 偏移半径;
    _H;//容器高度
    _W;//宽度
   _rStep; // 单次扫描长度;
   _curStep = 0; // 当前角度步骤;

    _startDegree // 起始角度
    _stepDegrees = 2; // 单次扫描角度(暂定);

        //var stepDegrees = 360 / scanStep; // 单次扫描角度(暂定);
    _cycleData; //数据
    _colorData; //颜色数据
    _keyAry; //获取步长和总长度
    constructor(o,bMap) {
      o = null == o ? {} : o;
      this.o= o;
      this.bMap = bMap
    }
    frame() {
        const canvasFm = document.createElement("div");
        canvasFm.style.position = "absolute";
        this._scanRadarCanvas = document.createElement("canvas");
        this._ctx = this._scanRadarCanvas.getContext("2d");
        canvasFm.appendChild(this._scanRadarCanvas);
        this._canvasFm = canvasFm
        return this._canvasFm
    }

    // 设置透明度
    setOpacity (op) {
        let opacity = this._defaultRadius; // 透明度;
        if (op >= 1 && op <= 100) {
            opacity = op;
        } else {
            opacity = this._defaultRadius;
        }

        let moz_o = opacity / 100;
        if (this._canvasFm.style.opacity !== undefined) {
            this._canvasFm.style.opacity = moz_o;
        }
        if (this._canvasFm.style.MozOpacity !== undefined) {
            this._p.style.MozOpacity = moz_o;
        }
        this._canvasFm.style.filter = "alpha(opacity=" + opacity + ")";
    }

    getHeight() {
        return this._canvasFm.clientHeight;
    }

    getWidth() {
        return this._canvasFm.clientWidth;
    }

    setData(data) {
        this._keyAry = [];
        this._cycleData = data;
        if (data) {
            for (let key in data[0]) {
                this._keyAry.push(key);
            }
            this._keyAry.sort();
            this._reColor();
        }
    }
    _reColor(){
        this._colorData = new Array();
        for (let i = 0; i < this._cycleData.length; i++) {
            let item = this._cycleData[i];
            let oneLine = new Array();
            for (let j = 0; j < this._keyAry.length; j++) {
                oneLine.push(radarDataColor[this._getIndex(item[this._keyAry[j]], 0, 320)]);
            }
            this._colorData.push(oneLine);
        }
    }

    setRadius(radius) {
        var _radius = parseInt(radius, 10);
        _radius = isNaN(_radius) ? this._defaultRadius : _radius;
        this._R = _radius < 1 ? this._defaultRadius : _radius;
        this._rStep = this._R  / this._p; //半径/分辨率 = 步长
        //rStep=7.5;
        this._offsetR = this._R; // 偏移半径;
        this._H = this._offsetR  * 2;
        this._W = this._offsetR  * 2;

        this._canvasFm.style.height = (this._H + 50) + "px";
        this._canvasFm.style.width = this._W + "px";
        this._scanRadarCanvas.height = this._H;
        this._scanRadarCanvas.width = this._W;
        this._ctx.lineWidth = this._rStep * 2;
        this._ctx.save();
        console.log(this._canvasFm,'执行没有')
    }
    clear() {
    }
     // 获取弧度;
    _getRads(degrees) {
        return(Math.PI * degrees) / 180;
    }
    // 获取角度;
    _getDegrees (rads) {
        return (rads * 180) / Math.PI;
    }

    _GetPiexValueByRealDistance(realDistance) {
        const pointA = this.bMap.getCenter();
        const pointAPixel = this.bMap.pointToOverlayPixel(pointA);
        // eslint-disable-next-line no-undef
        const pointB = new BMap.Point(pointA.lng, pointA.lat + 10);
        const pointBPixel = this.bMap.pointToOverlayPixel(pointB);

        const piexlDistanceBetween2Points = Math.abs(pointBPixel.y - pointAPixel.y);
        if (piexlDistanceBetween2Points <= 1) {
            return null;
        }
        const realDistanceBetween2Points = this.bMap.getDistance(pointA, pointB);
        const cp = realDistanceBetween2Points / piexlDistanceBetween2Points;
        const pixelDistance = realDistance / cp;
        return pixelDistance;
    }

    _getIndex(data, start, end) {
        if (data >= radarDataRange[319]) {
            return 319;
        }
        if (end - start == 1) {
            return start;
        }
        let midle = parseInt((start + end) / 2);
        if (data < radarDataRange[midle]) {
            return this._getIndex(data, start, midle);
        } else if (data >= radarDataRange[midle]) {
            return this._getIndex(data, midle, end);
        }
    }
    _drawStep () {
        this._scanStep = 180 - (parseInt(this._startDegree) / 2); // 扫描步骤数(暂定);
        if (this._curStep >= this._scanStep) {
            this._ctx.closePath();
            window.clearInterval(this._drawStep);
            return;
        }
        this._doDrawStep(this._curStep);
        this._curStep++;
    }

    _doDrawStep (step) {
        this._startDegree = this.o.degree
        let beginDegrees = this._startDegree + step * this._stepDegrees - 90;
        let endDegrees = beginDegrees + this._stepDegrees;
        let beginRads = this._getRads(beginDegrees);
        let endRads = this._getRads(endDegrees);
        let oneStep = this._keyAry[1] * 1000;
        if (this._colorData && this._colorData.length > 0) {
            for (var i = 0; i <= this._p; i++) {
                this._ctx.beginPath();
                if (i === 134 || i === 268 || i === 400 || i === 667) {
                    this._ctx.strokeStyle = "black";
                } else {
                    if (this._curStep >= this._colorData.length) {
                        return;
                    }
                    this._ctx.strokeStyle = this._colorData[this._curStep][i];
                }
                this._ctx.save();
                this._ctx.arc(this._offsetR, this._offsetR, this._GetPiexValueByRealDistance((i * oneStep) * Math.cos(2 * Math.PI / 360 * 25)), beginRads, endRads);
                this._ctx.stroke();
                this._ctx.restore();
            }
        }
    }
    draw(){
        clearInterval(this._drawStep)
        this._curStep = 0
        setInterval(() => {this._drawStep()}, 1)
    }

  }
